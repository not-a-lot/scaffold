<Application>
  <Workflows>
    <Workflow Id="Case">
      <Documents TemplateBaseURL="../templates/">
        <Document Tab="case-info" AtStatus="1" Blender="yes" class="case">
          <Controller>case</Controller>
          <Template>case</Template>
          <Action Type="status" AtStatus="1"/>
          <Action Type="update" AtStatus="1"/>
        </Document>
      </Documents>
      <Transitions>
        <Transition From="1" To="-1" GenericError="INCOMPLETE-DOCUMENT">
          <Assert Base="$case/Information/ClientEnterprise" Error="MISSING-ENTERPRISE-STATS">
            <true>count($base/TargetedMarkets/*) &gt;= 1</true>
            <true>$base/DomainActivityRef[. ne '']</true>
            <true>$base/SizeRef[. ne '']</true>
            <true>$base/CreationYear[. ne '']</true>
          </Assert>
          <Assert Base="$case/Evaluation/KAMReport" Error="MISSING-EVALUATION-NEEDS-ANALYSIS">
            <true>count($base/Recognition/*) &gt;= 2</true>
            <true>count($base/Tools/*) &gt;= 2</true>
          </Assert>
        </Transition>
      </Transitions>
    </Workflow>
  </Workflows>
  <Security>
    <Documents>
      <!-- Main documents shown on accordion tabs -->
      <Document TabRef="case-info" Root="Case">
        <Action Type="update">
          <Meet>r:kam</Meet>
        </Action>
      </Document>
    </Documents>
    <Resources>
      <Resource Name="Case">
        <Action Type="create">
          <Meet>g:account-manager</Meet>
        </Action>
        <Action Type="open">
          <Meet>s:omni g:account-manager r:coach</Meet>
        </Action>
      </Resource>
      <Resource Name="Person">
        <Action Type="update">
          <Meet Format="eval">user:get-current-person-id() eq $resource/Id/text()</Meet>
        </Action>
      </Resource>
    </Resources>
    <Omnipotent>
      <Meet>u:admin g:admin-system</Meet>
    </Omnipotent>
  </Security>
</Application>
